<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Source Class 计算器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: auto;
            height: 2000px;
        }
        .input-group {
            margin-bottom: 10px;
        }
        .input-group label {
            display: inline-block;
            width: 150px;
        }
        .input-group input {
            width: 200px;
        }
    </style>
</head>
<body>


    <h1>Source Class 输入与计算</h1>

    <div class="input-group">
        <label for="source1">Source Class 1：</label>
        <input type="text" id="source1" placeholder="名称" value="EXE_Source">
        <input type="number" id="value1" placeholder="值" value="425271">
        <span id="percentage1" style="display: inline-block; margin-left: 10px;">0%</span>
    </div>
    
    <div class="input-group">
        <label for="source2">Source Class 2：</label>
        <input type="text" id="source2" placeholder="名称" value="RemoteAccessService">
        <input type="number" id="value2" placeholder="值" value="78865">
        <span id="percentage2" style="display: inline-block; margin-left: 10px;">0%</span>
    </div>
    
    <div class="input-group">
        <label for="source3">Source Class 3：</label>
        <input type="text" id="source3" placeholder="名称" value="Proxy">
        <input type="number" id="value3" placeholder="值" value="35759">
        <span id="percentage3" style="display: inline-block; margin-left: 10px;">0%</span>
    </div>
    
    <div class="input-group">
        <label for="source4">Source Class 4：</label>
        <input type="text" id="source4" placeholder="名称" value="Undesirable">
        <input type="number" id="value4" placeholder="值" value="34285">
        <span id="percentage4" style="display: inline-block; margin-left: 10px;">0%</span>
    </div>
    
    <div class="input-group">
        <label for="source5">Source Class 5：</label>
        <input type="text" id="source5" placeholder="名称" value="Misc activity">
        <input type="number" id="value5" placeholder="值" value="28056">
        <span id="percentage5" style="display: inline-block; margin-left: 10px;">0%</span>
    </div>
    
    <button onclick="calculate()">计算</button>
    
    <h2>class 计算结果</h2>
    <div id="result"></div>
    <div id="percentages"></div>

<h1>Index 输入与计算</h1>
<div class="input-group">
    <label for="index1">Index 1：</label>
    <input type="text" id="index1" placeholder="名称" value="omni-bro-conn">
    <input type="number" id="indexValue1" placeholder="值" value="142699025">
</div>

<div class="input-group">
    <label for="index2">Index 2：</label>
    <input type="text" id="index2" placeholder="名称" value="omni-bro-http-realtime">
    <input type="number" id="indexValue2" placeholder="值" value="2104784">
</div>





<div class="input-group">
    <label for="index5">Index 5：</label>
    <input type="text" id="index5" placeholder="名称" value="ssl">
    <input type="number" id="indexValue5" placeholder="值" value="12761880">
</div>

<div class="input-group">
    <label for="index6">Index 6：</label>
    <input type="text" id="index6" placeholder="名称" value="event">
    <input type="number" id="indexValue6" placeholder="值" value="755839">
</div>

<div class="input-group">
    <label for="index7">Index 7：</label>
    <input type="text" id="index7" placeholder="名称" value="dhcp">
    <input type="number" id="indexValue7" placeholder="值" value="0">
</div>

<div class="input-group">
    <label for="index8">Index 8：</label>
    <input type="text" id="index8" placeholder="名称" value="smtp">
    <input type="number" id="indexValue8" placeholder="值" value="0">
</div>


<div class="input-group">
    <label for="index4">Index 4：</label>
    <input type="text" id="index4" placeholder="名称" value="smb">
    <input type="number" id="indexValue4" placeholder="值" value="44133">
</div>

<div class="input-group">
    <label for="index3">Index 3：</label>
    <input type="text" id="index3" placeholder="名称" value="omni-bro-dns">
    <input type="number" id="indexValue3" placeholder="值" value="0">
</div>

<button onclick="calculateTotalLog()">计算 Total Log</button>

<h2>计算结果</h2>

<div>
   Total Log :  <span id="totalResult"></span>
</div>


<h2>比例计算</h2>

<div id="logRatios">
    <ul>
        <li>Total: </li>
        <li>conn</li>
        <li>dns</li>
        <li>ssl</li>
        <li>http</li>
        <li>dhcp</li>
        <li>smb</li>
        <li>smtp</li>
        <li>event</li>
    </ul>
</div>

<button onclick="calculateLogRatios()">计算 LOG_RATIOS</button>

<div id="valueDisplay">
    <!-- 显示对应的 value -->
</div>







<script>
    let resultJson = {}; // Define resultJson in a broader scope

    function calculate() {
        const sources = [
            { name: document.getElementById("source1").value, value: parseFloat(document.getElementById("value1").value) || 0 },
            { name: document.getElementById("source2").value, value: parseFloat(document.getElementById("value2").value) || 0 },
            { name: document.getElementById("source3").value, value: parseFloat(document.getElementById("value3").value) || 0 },
            { name: document.getElementById("source4").value, value: parseFloat(document.getElementById("value4").value) || 0 },
            { name: document.getElementById("source5").value, value: parseFloat(document.getElementById("value5").value) || 0 }
        ];

        const totalLog = sources.reduce((acc, source) => acc + source.value, 0);

        // Calculate and display percentages
        sources.forEach((source, index) => {
            const percentage = totalLog > 0 ? (source.value / totalLog * 100).toFixed(2) : 0;
            document.getElementById(`percentage${index + 1}`).innerText = `${percentage}%`;
        });

        const sourceClass = {};
        sources.forEach(source => {
            if (source.name) {
                sourceClass[source.name] = source.value;
            }
        });

        resultJson = {
            sourceClassTopN: {
                totalLog: totalLog,
                sourceClass: sourceClass
            }
        };

        document.getElementById("result").innerHTML = `
            <pre>${JSON.stringify(resultJson, null, 2)}</pre>
        `;
    }

    function calculateLogRatios() {
        const totalIndexLog = parseFloat(document.getElementById("totalResult").innerText) || 0; // 获取动态的 totalIndexLog
        const previousTotalLog = parseFloat(resultJson.sourceClassTopN.totalLog) || 0; // 获取动态的 previousTotalLog
        const total = totalIndexLog - previousTotalLog * 3; // 计算总值

        const indexValues = {
            conn: (parseFloat(document.getElementById("indexValue1").value) || 0),
            dns: (parseFloat(document.getElementById("indexValue3").value) || 0),
            ssl: (parseFloat(document.getElementById("indexValue5").value) || 0),
            http: (parseFloat(document.getElementById("indexValue2").value) || 0),
            dhcp: (parseFloat(document.getElementById("indexValue7").value) || 0),
            smb: (parseFloat(document.getElementById("indexValue4").value) || 0),
            smtp: (parseFloat(document.getElementById("indexValue8").value) || 0),
            event: (parseFloat(document.getElementById("indexValue6").value) || 0)
        };

        // Clear previous results
        const logRatiosList = document.querySelector("#logRatios ul");
        logRatiosList.innerHTML = `<li>Total: ${total} (计算: ${totalIndexLog} - ${previousTotalLog} * 3)</li>`;

        // Move calculations to the end
        for (const [key, value] of Object.entries(indexValues)) {
            let ratio;
            if (key === 'smb' || key === 'dhcp' || key === 'smtp' || key === 'dns' || key === 'ssl') {
                ratio = value / total; // Directly use smb input value for calculation
                logRatiosList.innerHTML += `<li>${key}: ${value === 0 ? 0 : (ratio * 100).toFixed(2)}% (计算: ${value} / ${total})</li>`;
            } else {
                ratio = (value - previousTotalLog) / total; // Other calculations
                logRatiosList.innerHTML += `<li>${key}: ${value === 0 ? 0 : (ratio * 100).toFixed(2)}% (计算: (${value} - ${previousTotalLog}) / ${total})</li>`;
            }
        }
    }

    function calculateTotalLog() {
        const indexSources = [
            { name: document.getElementById("index1").value, value: parseFloat(document.getElementById("indexValue1").value) || 0 },
            { name: document.getElementById("index2").value, value: parseFloat(document.getElementById("indexValue2").value) || 0 },
            { name: document.getElementById("index3").value, value: parseFloat(document.getElementById("indexValue3").value) || 0 },
            { name: document.getElementById("index4").value, value: parseFloat(document.getElementById("indexValue4").value) || 0 },
            { name: document.getElementById("index5").value, value: parseFloat(document.getElementById("indexValue5").value) || 0 },
            { name: document.getElementById("index6").value, value: parseFloat(document.getElementById("indexValue6").value) || 0 }
        ];

        const totalIndexLog = indexSources.reduce((acc, index) => acc + index.value, 0);

        document.getElementById("totalResult").innerHTML = `
            ${totalIndexLog}
        `;
    }

    // Automatically execute calculate() when the page loads
    window.onload = function() {
        calculate();
        calculateTotalLog()
    };
</script>

</body>
</html>